# Flowable 工作流系统部署验证清单

## 部署前准备

### 🔧 **环境要求验证**
- [ ] Java 21 运行环境已安装
- [ ] PostgreSQL 数据库已配置并运行
- [ ] Redis 服务已配置（可选，用于缓存）
- [ ] 应用服务器内存 ≥ 2GB
- [ ] 磁盘可用空间 ≥ 10GB

### 📋 **配置文件检查**

#### application.yml
- [ ] 数据库连接配置正确
  ```yaml
  spring:
    datasource:
      url: jdbc:postgresql://localhost:5432/emsdb
      username: ems
      password: example
  ```
- [ ] Flowable 引擎配置
  ```yaml
  workflow:
    engine: flowable
  ```
- [ ] Redis 缓存配置（如启用）
- [ ] 日志级别设置适当

#### application-prod.yml
- [ ] 生产环境数据库配置
- [ ] 性能调优参数配置
- [ ] 安全配置检查
- [ ] 日志文件路径配置

### 🗄️ **数据库准备**
- [ ] PostgreSQL 数据库创建完成
- [ ] 数据库用户权限配置正确
- [ ] Flyway 迁移脚本 V10__Add_Flowable_Integration.sql 已准备
- [ ] 备份策略已制定

## 部署步骤验证

### 1. **应用构建**
```bash
# 后端构建
cd backend
./mvnw clean package -DskipTests

# 前端构建  
cd ../frontend/turtle-web
npm run build
```
- [ ] 后端构建成功，jar 包生成
- [ ] 前端构建成功，dist 目录生成
- [ ] 无编译错误或警告

### 2. **数据库迁移**
```bash
# 执行数据库迁移
./mvnw flyway:migrate
```
- [ ] Flyway 迁移执行成功
- [ ] Flowable 相关表自动创建
- [ ] approval_requests 表新增 Flowable 字段

### 3. **应用启动**
```bash
# 启动应用
java -jar target/turtle-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod
```
- [ ] 应用启动无错误
- [ ] Flowable 引擎初始化成功
- [ ] BPMN 流程文件自动部署

## 功能验证测试

### 🔄 **核心功能测试**

#### 流程定义验证
- [ ] 访问 `/workflow/flowable-admin` 管理界面
- [ ] 查看流程定义列表，确认包含：
  - [ ] reimbursement_approval (报销审批流程)
  - [ ] contract_approval (合同审批流程)
- [ ] 流程定义状态为 "活跃"

#### 工作流提交测试
- [ ] 通过报销管理界面提交新报销申请
- [ ] 验证工作流自动启动
- [ ] 检查 approval_requests 表中记录包含 flowable_process_instance_id
- [ ] 在 Flowable 管理界面能看到对应的流程实例

#### 任务处理测试  
- [ ] 在 Flowable 管理界面查看待办任务
- [ ] 能够认领和完成任务
- [ ] 任务完成后流程自动流转到下一步
- [ ] 流程变量正确传递

#### 金额路由测试
测试不同金额的报销申请路由：
- [ ] ≤1000元 → 财务审批
- [ ] 1000-5000元 → 总经理审批  
- [ ] >5000元 → CEO审批

#### 并行流程测试（合同审批）
- [ ] 提交>10万元合同审批
- [ ] 验证法务和财务并行审核
- [ ] 两个任务都完成后流程继续

### 📊 **监控和日志验证**
- [ ] 系统日志正常记录工作流操作
- [ ] 访问 `/actuator/health` 显示系统健康
- [ ] 访问 `/actuator/metrics` 查看性能指标
- [ ] 流程执行性能在可接受范围内

### 🔐 **权限和安全验证**
- [ ] 只有具有 `workflow.admin` 权限的用户能访问管理界面
- [ ] 任务只能被正确的用户/角色处理
- [ ] 流程变量中无敏感信息泄露
- [ ] 审计日志正确记录所有关键操作

## 性能验证测试

### 负载测试
- [ ] 并发创建 50 个工作流实例无异常
- [ ] 批量处理 100 个任务响应时间 < 5秒
- [ ] 系统内存使用稳定，无内存泄漏
- [ ] 数据库连接池正常工作

### 压力测试
- [ ] 1000+ 工作流实例同时运行系统稳定
- [ ] 长时间运行（24小时）无异常
- [ ] 垃圾回收正常，系统响应稳定

## 故障恢复验证

### 异常处理
- [ ] 数据库连接中断后自动恢复
- [ ] 流程执行异常时有适当错误处理
- [ ] 系统重启后流程实例状态正确恢复

### 回滚测试
- [ ] 能够安全回滚到传统工作流引擎
  ```yaml
  workflow:
    engine: legacy
  ```
- [ ] 现有审批流程不受影响
- [ ] 数据完整性保持

## 生产环境优化

### 📈 **性能调优**
- [ ] 数据库连接池参数优化
  ```yaml
  spring:
    datasource:
      hikari:
        maximum-pool-size: 20
        minimum-idle: 5
  ```
- [ ] Flowable 异步执行器配置
  ```yaml
  flowable:
    async-executor:
      core-pool-size: 4
      max-pool-size: 20
  ```
- [ ] 缓存配置启用
- [ ] JVM 参数调优

### 🔧 **监控配置**
- [ ] 应用性能监控 (APM) 配置
- [ ] 数据库监控配置
- [ ] 日志聚合和分析配置
- [ ] 告警规则设置

### 🛡️ **安全加固**
- [ ] 数据库访问权限最小化
- [ ] 应用端口和接口访问控制
- [ ] 敏感配置信息加密
- [ ] HTTPS 配置（生产环境）

## 备份和恢复

### 数据备份
- [ ] 数据库定时备份策略配置
- [ ] 应用日志备份配置
- [ ] 流程定义文件备份
- [ ] 配置文件备份

### 恢复测试
- [ ] 数据库恢复流程验证
- [ ] 应用快速重启流程
- [ ] 灾难恢复预案制定

## 用户培训和文档

### 培训准备
- [ ] 用户操作手册准备完成
- [ ] 管理员培训材料准备
- [ ] 系统演示环境准备
- [ ] 常见问题解答文档

### 文档完整性
- [ ] FLOWABLE_USER_GUIDE.md 文档完整
- [ ] API 文档更新
- [ ] 系统架构文档更新
- [ ] 运维手册编写完成

## 上线前最终检查

### ✅ **Go-Live 检查清单**
- [ ] 所有功能测试通过
- [ ] 性能测试达标
- [ ] 安全验证完成
- [ ] 备份恢复机制就绪
- [ ] 监控告警配置完成
- [ ] 运维团队培训完成
- [ ] 用户培训计划确定
- [ ] 应急预案制定完成
- [ ] 版本发布计划确认

### 🚀 **发布准备**
- [ ] 发布时间窗口确定
- [ ] 回滚计划准备就绪
- [ ] 相关团队已通知
- [ ] 发布后验证计划制定

## 上线后验证

### 即时验证（发布后 1 小时内）
- [ ] 系统启动正常
- [ ] 核心功能可用
- [ ] 性能指标正常
- [ ] 无严重错误日志

### 短期验证（发布后 24 小时内）
- [ ] 业务流程正常运行
- [ ] 用户反馈收集
- [ ] 系统稳定性确认
- [ ] 监控数据分析

### 长期跟踪（发布后一周内）
- [ ] 系统性能趋势分析
- [ ] 用户使用情况统计
- [ ] 问题收集和解决
- [ ] 优化建议制定

---

## 关键联系人

| 角色 | 姓名 | 联系方式 | 职责 |
|------|------|----------|------|
| 项目经理 | | | 整体协调 |
| 技术负责人 | | | 技术决策 |
| 运维工程师 | | | 部署和监控 |
| 测试工程师 | | | 质量保证 |
| 业务负责人 | | | 业务验收 |

**备注**: 请在实际部署时填写具体的联系信息。

---

*此清单应作为 Flowable 工作流系统部署的标准操作程序，确保每个步骤都得到验证和确认。*